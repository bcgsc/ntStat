jobs:

- job:
  displayName: ubuntu-latest
  pool:
    vmImage: 'ubuntu-latest'

  steps:
  - checkout: self
    persistCredentials: true
    submodules: true

  - script: |
      sudo apt-get update
      sudo apt-get install -y python3-dev
      echo "##vso[task.prependpath]$CONDA/bin"
      conda env create --file environment.yaml
    displayName: Setup environment

  - script: |
      source activate ntstat
      export CFLAGS="$CFLAGS $(python3-config --cflags)"
      export LDFLAGS="$LDFLAGS $(python3-config --ldflags)"
      meson setup build
      meson install -C build
    displayName: Compile ntStat
